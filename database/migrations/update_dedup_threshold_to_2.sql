-- =====================================================
-- 数据库迁移脚本：更新异动去重阈值为2%
-- 日期：2025-11-12
-- 说明：将 dedup_change_diff_threshold 从1%提升到2%
-- =====================================================

-- 更新去重阈值配置
INSERT INTO oi_config (config_key, config_value, description)
VALUES ('dedup_change_diff_threshold', '2', '异动去重阈值（百分比）- 变化率差异小于此值视为重复异动')
ON DUPLICATE KEY UPDATE
  config_value = '2',
  description = '异动去重阈值（百分比）- 变化率差异小于此值视为重复异动';

-- =====================================================
-- 验证更新结果
-- =====================================================

-- 查看更新后的配置
SELECT * FROM oi_config WHERE config_key = 'dedup_change_diff_threshold';

-- =====================================================
-- 回滚方案（如需回滚到1%）
-- =====================================================

-- UPDATE oi_config
-- SET config_value = '1'
-- WHERE config_key = 'dedup_change_diff_threshold';

-- =====================================================
-- 注意事项
-- =====================================================

-- 1. 阈值提升后，会过滤掉更多相似的异动记录
-- 2. 例如：前一次异动5%，这次异动6.5%，差异1.5% < 2%，会被过滤
-- 3. 建议观察异动检测效果，必要时可调回1%
-- 4. 修改后无需重启服务，下次轮询时自动加载新配置
